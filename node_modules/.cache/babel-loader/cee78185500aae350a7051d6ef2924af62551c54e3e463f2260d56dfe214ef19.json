{"ast":null,"code":"'use strict';\n\nconst childProcess = require('child_process');\nconst ip = require('./ip');\nconst _ = require('./helper');\nconst chalk = _.chalk;\nconst isWindows = _.platform.isWindows;\nconst command = isWindows ? 'tracert' : 'traceroute';\nconst hopParser = function (hop) {\n  const data = hop.replace(/\\n$/, '').trim();\n  const res = data.split(' ');\n  if (res.length < 5) {\n    return null;\n  }\n  return {\n    host: res[2],\n    delta: res[4]\n  };\n};\nmodule.exports = function main(argv) {\n  const host = argv[0];\n  const args = isWindows ? ['-d', host] : ['-q', 1, '-n', host];\n  const child = childProcess.spawn(command, args);\n  var customQueue = new _.CustomQueue();\n  customQueue.next();\n  let counter = 0;\n  let killCounter = 0;\n  child.stdout.on('data', data => {\n    const hop = hopParser(data.toString());\n    if (hop) {\n      customQueue.add(function () {\n        var queue = this;\n        ip.getInfoByHop(hop, queue);\n        counter++;\n      });\n      killCounter = 0;\n    } else {\n      killCounter++;\n    }\n    if (killCounter >= 3) {\n      child.kill();\n    }\n  });\n  setTimeout(() => {\n    customQueue.next();\n  }, 1000);\n  process.on('exit', code => {\n    console.log(`\\n  traceroute finished with: ${chalk.cyan(counter)} hops`);\n  });\n};","map":{"version":3,"names":["childProcess","require","ip","_","chalk","isWindows","platform","command","hopParser","hop","data","replace","trim","res","split","length","host","delta","module","exports","main","argv","args","child","spawn","customQueue","CustomQueue","next","counter","killCounter","stdout","on","toString","add","queue","getInfoByHop","kill","setTimeout","process","code","console","log","cyan"],"sources":["/home/lenovo/node_modules/net-tools/lib/traceroute.js"],"sourcesContent":["'use strict';\n\nconst childProcess = require('child_process');\n\nconst ip = require('./ip');\nconst _ = require('./helper');\n\nconst chalk = _.chalk;\n\nconst isWindows = _.platform.isWindows;\nconst command = isWindows ? 'tracert' : 'traceroute';\n\nconst hopParser = function(hop) {\n  const data = hop.replace(/\\n$/, '').trim();\n  const res = data.split(' ');\n  if (res.length < 5) {\n    return null;\n  }\n  return {\n    host: res[2],\n    delta: res[4]\n  };\n};\n\nmodule.exports = function main(argv) {\n  const host = argv[0];\n  const args = isWindows ? ['-d', host] : ['-q', 1, '-n', host];\n\n  const child  = childProcess.spawn(command, args);\n\n  var customQueue = new _.CustomQueue();\n\n  customQueue.next();\n\n  let counter = 0;\n  let killCounter = 0;\n  child.stdout.on('data', data => {\n    const hop = hopParser(data.toString());\n\n    if (hop) {\n      customQueue.add(function() {\n        var queue = this;\n        ip.getInfoByHop(hop, queue);\n        counter++;\n      });\n      killCounter = 0;\n    } else {\n      killCounter++;\n    }\n\n    if (killCounter >= 3) {\n      child.kill();\n    }\n  });\n\n  setTimeout(() => {\n    customQueue.next();\n  }, 1000);\n\n  process.on('exit', code => {\n    console.log(`\\n  traceroute finished with: ${chalk.cyan(counter)} hops`);\n  });\n};\n"],"mappings":"AAAA,YAAY;;AAEZ,MAAMA,YAAY,GAAGC,OAAO,CAAC,eAAe,CAAC;AAE7C,MAAMC,EAAE,GAAGD,OAAO,CAAC,MAAM,CAAC;AAC1B,MAAME,CAAC,GAAGF,OAAO,CAAC,UAAU,CAAC;AAE7B,MAAMG,KAAK,GAAGD,CAAC,CAACC,KAAK;AAErB,MAAMC,SAAS,GAAGF,CAAC,CAACG,QAAQ,CAACD,SAAS;AACtC,MAAME,OAAO,GAAGF,SAAS,GAAG,SAAS,GAAG,YAAY;AAEpD,MAAMG,SAAS,GAAG,SAAAA,CAASC,GAAG,EAAE;EAC9B,MAAMC,IAAI,GAAGD,GAAG,CAACE,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CAACC,IAAI,CAAC,CAAC;EAC1C,MAAMC,GAAG,GAAGH,IAAI,CAACI,KAAK,CAAC,GAAG,CAAC;EAC3B,IAAID,GAAG,CAACE,MAAM,GAAG,CAAC,EAAE;IAClB,OAAO,IAAI;EACb;EACA,OAAO;IACLC,IAAI,EAAEH,GAAG,CAAC,CAAC,CAAC;IACZI,KAAK,EAAEJ,GAAG,CAAC,CAAC;EACd,CAAC;AACH,CAAC;AAEDK,MAAM,CAACC,OAAO,GAAG,SAASC,IAAIA,CAACC,IAAI,EAAE;EACnC,MAAML,IAAI,GAAGK,IAAI,CAAC,CAAC,CAAC;EACpB,MAAMC,IAAI,GAAGjB,SAAS,GAAG,CAAC,IAAI,EAAEW,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,EAAE,IAAI,EAAEA,IAAI,CAAC;EAE7D,MAAMO,KAAK,GAAIvB,YAAY,CAACwB,KAAK,CAACjB,OAAO,EAAEe,IAAI,CAAC;EAEhD,IAAIG,WAAW,GAAG,IAAItB,CAAC,CAACuB,WAAW,CAAC,CAAC;EAErCD,WAAW,CAACE,IAAI,CAAC,CAAC;EAElB,IAAIC,OAAO,GAAG,CAAC;EACf,IAAIC,WAAW,GAAG,CAAC;EACnBN,KAAK,CAACO,MAAM,CAACC,EAAE,CAAC,MAAM,EAAErB,IAAI,IAAI;IAC9B,MAAMD,GAAG,GAAGD,SAAS,CAACE,IAAI,CAACsB,QAAQ,CAAC,CAAC,CAAC;IAEtC,IAAIvB,GAAG,EAAE;MACPgB,WAAW,CAACQ,GAAG,CAAC,YAAW;QACzB,IAAIC,KAAK,GAAG,IAAI;QAChBhC,EAAE,CAACiC,YAAY,CAAC1B,GAAG,EAAEyB,KAAK,CAAC;QAC3BN,OAAO,EAAE;MACX,CAAC,CAAC;MACFC,WAAW,GAAG,CAAC;IACjB,CAAC,MAAM;MACLA,WAAW,EAAE;IACf;IAEA,IAAIA,WAAW,IAAI,CAAC,EAAE;MACpBN,KAAK,CAACa,IAAI,CAAC,CAAC;IACd;EACF,CAAC,CAAC;EAEFC,UAAU,CAAC,MAAM;IACfZ,WAAW,CAACE,IAAI,CAAC,CAAC;EACpB,CAAC,EAAE,IAAI,CAAC;EAERW,OAAO,CAACP,EAAE,CAAC,MAAM,EAAEQ,IAAI,IAAI;IACzBC,OAAO,CAACC,GAAG,CAAE,iCAAgCrC,KAAK,CAACsC,IAAI,CAACd,OAAO,CAAE,OAAM,CAAC;EAC1E,CAAC,CAAC;AACJ,CAAC"},"metadata":{},"sourceType":"script","externalDependencies":[]}